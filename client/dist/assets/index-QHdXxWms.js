import{e as F,d as e,j as c,_ as p}from"./index-f9tINDKs.js";import{r as M,d as N,L as A,o as G}from"./chart-DqjXtJ1z.js";import{A as x,a as w}from"./index-6DoP2ZkM.js";import{s as v}from"./index-9zJ0Jxpp.js";M();const H=()=>{const{id:r}=F(),[E,g]=e.useState(N()),[l,y]=e.useState(0),[a,S]=e.useState([]),[j,k]=e.useState(""),[B,C]=e.useState(""),[L,D]=e.useState({label:"",timestamp:"",value:""}),[P,I]=e.useState(),[R,T]=e.useState();v.emit("send_message",r==null?void 0:r.toString()),v.on("receive_message",()=>{}),e.useEffect(()=>{(async()=>{var s,o;try{const t=await w.get(`${x}/beaconData?walkID=${r}`);S(t==null?void 0:t.data),I((s=t==null?void 0:t.data[0])==null?void 0:s.time),T((o=t==null?void 0:t.data[(t==null?void 0:t.data.length)-1])==null?void 0:o.time)}catch(t){console.log("Get Beacon Error : ",t)}})()},[]),e.useEffect(()=>{const i=async()=>{var t,d,m;const o=(t=a==null?void 0:a[l])==null?void 0:t.time;k(o),C((d=a==null?void 0:a[l])==null?void 0:d.beaconData),D({label:`Beacon ${r}`,timestamp:o,value:((m=a[l])==null?void 0:m.yMP)||0}),g(n=>{var u,b,h,f;const $=[...n.labels,(u=a[l])==null?void 0:u.xMP],U=[...n.datasets[0].data,(b=a[l])==null?void 0:b.yMP],W=[...(f=(h=n==null?void 0:n.datasets)==null?void 0:h[0])==null?void 0:f.timestamps,o];return{labels:$,datasets:[{...n.datasets[0],data:U,timestamps:W}]}}),y(n=>n+1)},s=setInterval(()=>i(),1500);return()=>clearInterval(s)},[l]);const _=async()=>{const i=`${x}/downloadcsv?id=${r}`;try{const s=await w({url:i,method:"GET",responseType:"blob"}),o=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=o,t.download="users.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t),p.success("Walk Downloaded")}catch(s){console.error("Error downloading CSV:",s),p.success("Error Downloading Walk")}};return c.jsxs(c.Fragment,{children:[c.jsx(A,{options:G(),data:E,tooltip:L}),c.jsx("button",{className:"flex ml-auto bg-blue-500 hover:bg-blue-700 text-black border font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:_,children:"Export Walk"}),c.jsxs("div",{children:["First event : ",P]}),c.jsxs("div",{children:["Last Event : ",R]}),c.jsxs("div",{children:["Current Event : ",j]}),c.jsxs("div",{children:["Beacon Data : ",B]})]})};export{H as BeaconReplay,H as default};
