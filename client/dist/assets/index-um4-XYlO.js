import{b as U,r as a,_ as V,j as n}from"./index-ehr2yu45.js";import{u as X,b as Y,d as Z,c as $,f as W}from"./index-lXNKAdFQ.js";import{r as w,d as k,L as D,o as ss}from"./chart-ABZ4Nk8n.js";import{s as E}from"./index-V5KFWZq-.js";w();const is=()=>{var d,m;const{id:i}=U(),[N,L]=a.useState(k()),[s,_]=a.useState([]),[B,I]=a.useState(""),[T,q]=a.useState(""),[e,v]=a.useState(0),[R,A]=a.useState(0),{isPending:ts,error:c,data:o}=X({queryKey:["walkData"],queryFn:()=>W(i,_)});return E.emit("send_message",i==null?void 0:i.toString()),E.on("receive_message",()=>{}),Y(s),a.useEffect(()=>{const K=async()=>{var x,b,P,p,M,f,g;const r=(x=s==null?void 0:s[e])==null?void 0:x.time,z=((b=s==null?void 0:s[e])==null?void 0:b.xMP0)??0,l=(P=s==null?void 0:s[e])==null?void 0:P.beaconData;r&&I(r),l&&q(l);const G=parseFloat((p=s==null?void 0:s[e])==null?void 0:p.xMP),u=parseFloat((M=s==null?void 0:s[e])==null?void 0:M.yMP);if(e>1&&u){const{distance:t}=$(parseFloat((f=s[e-1])==null?void 0:f.xMP)??0,parseFloat((g=s[e-1])==null?void 0:g.yMP)??0,G,u);A(t)}L(t=>{var y,h,j,S,F,C;const H=[...t.labels,(y=s[e])==null?void 0:y.xMP],J=[...t.datasets[0].data,(h=s[e])==null?void 0:h.yMP],O=[...(S=(j=t==null?void 0:t.datasets)==null?void 0:j[0])==null?void 0:S.timestamps,r];return{labels:H,datasets:[{...t.datasets[0],data:J,timestamps:O,xMP0:[...(C=(F=t==null?void 0:t.datasets)==null?void 0:F[0])==null?void 0:C.xMP0,z]}]}}),v(t=>t+1)},Q=setInterval(()=>K(),1500);return()=>clearInterval(Q)},[e]),c&&V.error(c.message),n.jsxs(n.Fragment,{children:[n.jsx(D,{options:ss(),data:N}),n.jsxs("div",{className:"flex",children:[n.jsxs("span",{className:"pt-2",children:["Distance : ",R," m"]}),n.jsx("button",{className:"flex ml-auto bg-blue-500 hover:bg-blue-700 text-black dark:text-white border font-bold py-2 px-4 rounded-md focus:outline-none focus:shadow-outline",onClick:()=>Z(i),children:"Export Walk"})]}),n.jsxs("div",{children:["First event : ",(d=o==null?void 0:o[0])==null?void 0:d.time]}),n.jsxs("div",{children:["Last Event : ",(m=o==null?void 0:o[(o==null?void 0:o.length)-1])==null?void 0:m.time]}),n.jsxs("div",{children:["Current Event : ",B]}),n.jsxs("div",{children:["Beacon Data : ",T]})]})};export{is as BeaconReplay,is as default};
